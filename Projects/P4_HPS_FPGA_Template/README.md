# HPS_FPGA_Template Setup Guide

This guide provides step-by-step instructions to set up the `HPS_FPGA_Template` for the Terasic DE1-SoC board. The template integrates the Hard Processor System (HPS) with FPGA logic, allowing for custom hardware-software co-design projects.

## Table of Contents

- [Introduction](#introduction)
- [Prerequisites](#prerequisites)
- [Step-by-Step Setup](#step-by-step-setup)
  1. [Generate Template Top File](#1-generate-template-top-file)
  2. [Convert Verilog to VHDL](#2-convert-verilog-to-vhdl)
  3. [Configure Qsys and Add Components](#3-configure-qsys-and-add-components)
  4. [Integrate Generated HDL with Top File](#4-integrate-generated-hdl-with-top-file)
  5. [Generate Header File for HPS](#5-generate-header-file-for-hps)
  6. [Write and Compile C Code](#6-write-and-compile-c-code)
- [Conclusion](#conclusion)
- [TO-DO](#to-do)

## Introduction

The `HPS_FPGA_Template` allows one to leverage the capabilities of the HPS and FPGA on the Terasic DE1-SoC board, facilitating the development of complex hardware-software co-design projects. Setting up this template is necessary for ease of configuring future hardware/software co-design projects, providing a reusable foundation that integrates both the HPS and FPGA effectively.

## Prerequisites

Before you start, ensure you have the following:

- **Intel Quartus Prime**: Installed and configured.
- **SoC EDS (Embedded Design Suite)**: Installed for generating headers and compiling C code.
- **Terasic DE1-SoC board**: Properly connected to your development environment.
- **Basic knowledge**: Familiarity with FPGA design, VHDL/Verilog, and C programming.

## Step-by-Step Setup

### 1. Generate Template Top File

1. Open **Intel Quartus Prime**.
2. Use the **SoC Builder** tool to generate a template top file. This file serves as the starting point for your HPS-FPGA integration.
3. The generated top file is initially in Verilog format.

### 2. Convert Verilog to VHDL

1. Since the generated top file is in Verilog, manually convert it to VHDL for consistency with your project requirements.
2. Carefully translate each Verilog construct into its VHDL equivalent, ensuring that the logic and functionality remain unchanged.
3. Save the converted VHDL file in your project directory.

### 3. Configure Qsys and Add Components

1. Open **Platform Designer** (previously known as Qsys) within Quartus Prime.
2. Add the necessary components for your project. This typically includes:
   - **HPS component** for interfacing with the Hard Processor System.
   - **Memory interfaces** (e.g., SDRAM controller) if required.
   - **PIO (Parallel Input/Output)** for GPIO connections.
   - Any additional custom IP or peripherals needed for your design.
3. Configure each component according to your project's specifications.
4. Save the Qsys project and generate the HDL (Hardware Description Language) files.

### 4. Integrate Generated HDL with Top File

1. Link the generated HDL files from Qsys with your existing top file.
2. Ensure all signals and ports are correctly connected between the HPS, FPGA, and any custom components you've added.
3. Update the top-level entity to include any necessary connections or logic.

### 5. Generate Header File for HPS

1. Use the `sopc-create-header` command to generate the header file required for the HPS.
   
   ```bash
   sopc-create-header --sopc-file=<path_to_sopcinfo_file> --single=<output_header_file.h>
   
- This command uses the `.sopcinfo` file generated by Qsys to create a header file (`.h`) that defines the memory map and addresses for HPS-FPGA communication.  
- Include this header file in your C code to access the FPGA components from the HPS.

### 6. Write and Compile C Code

- Write the C code to interact with the FPGA from the HPS. This code should include the generated header file for memory-mapped I/O access.
- Create a `Makefile` to automate the compilation process. Ensure the Makefile specifies the correct toolchain and flags for the **SoC EDS toolchain** or your preferred cross-compiler.
- Run the `make` command in the terminal to compile the C code.
- Load the compiled binary onto the HPS (e.g., using `scp` over an ethernet connection).

## Conclusion

Following these steps, you have set up the `HPS_FPGA_Template` for the Terasic DE1-SoC board, integrating hardware (FPGA) and software (HPS) components. This setup serves as a foundation for developing complex co-design projects that leverage the full potential of the HPS and FPGA.

## Useful Resources
- [HPS - Hello PIO core](https://www.youtube.com/watch?v=6hjsMUAKtT8)
  
## TO-DO
- Implement functionality for the HPS to load the FPGA bitstream automatically. This will allow re-programming the FPGA from the HPS without manually using Quartus Prime.

